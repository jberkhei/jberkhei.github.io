<html>
<head>
<script src="https://code.jquery.com/jquery-latest.min.js" type="text/javascript"></script>

<script>

function redirectToStore(){
        if(navigator.userAgent.toLowerCase().indexOf("android") > -1){
            window.location.href = 'https://play.google.com/store/apps/details?id=com.bushnell.connect';
        }else if(navigator.userAgent.toLowerCase().indexOf("iphone") > -1){
            window.location.href = 'https://apps.apple.com/us/app/bushnell-connect/id1588783774';
        }else{
            window.location.href = 'https://apps.apple.com/us/app/bushnell-connect/id1588783774';
        }
}

function checkIfAppIsInstalled(scheme, timeout) {
				console.log("checkIfAppIsInstalled");
    return new Promise((resolve) => {
        let start = Date.now();
        window.location = scheme;
        setTimeout(function() {
            if (Date.now() - start < timeout + 200) {
                resolve(false);
            } else {
                resolve(true);
            }
        }, timeout);
    });
}

    $(document).ready(function (){	
    	const urlParams = new URLSearchParams(window.location.search);
    	const sessionId = urlParams.get('SessionId');
	const appUrl = sessionId ? 'bushnellconnect://?SessionId=${encodeURIComponent(sessionId)}' : "bushnellconnect://";
	    console.log("ready");

	checkIfAppInstalled(appUrl, 2000)
    		.then(isInstalled => {
        		if (isInstalled) {
				//openApp(); 
				console.log("openApp");
        		} else {
            			redirectToStore();
				console.log("redirectToStore");
        		}
    		});
    });
</script>
</head>
	<body></body>
</html>
